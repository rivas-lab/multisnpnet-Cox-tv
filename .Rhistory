use_r("coxtv")
library(devtools)
use_r("coxtv")
use_mit_license("Ruilin Li")
use_package("Rcpp")
devtools::document()
usethis::use_rcpp()
getwd()
devtools::build_vignettes()
devtools::document()
devtools::document()
devtools::build_vignettes()
devtools::build_vignettes()
seq(0, 1, length.out = 2)
seq(0, 1, length.out = 3)
all(c(0.0,  1.0) %in% c(0, 1))
all(c(0.0,  1.0, 0.5) %in% c(0, 1))
devtools::document()
devtools::build_vignettes()
a = matrix(rnorm(100),100,1)
a
quantile(a, c(0.1,0.2,0.3))
quantile(a, c(0.1,0.2,0.3,0.5))
ngroup = 4
q = seq(0, 1, length.out = ngroup+1)
q
q = q[-c(1, length(q))]
q
seq(0, 1, 3)
seq(0, 1, length.out = 3)
a
a[1:10]
dim(a)
-Inf
0 > -Inf
quantile(a , 0)
min(a)
Inf
Inf > 100
c(1,2,3,4,5,6) < 3.5 &  c(1,2,3,4,5,6) >= 2
b = matrix(rnorm(15),5,3)
v
b
b[2, ] = b[1, ] + 1
b
b[2, ] = b[1, ]/c(1,2,3)
v
b
a
b = data.frame(a)
b
as.numeric(b)
b  = dplyr::select(b, a)
b
as.numeric(b)
b
a = matrix(1, 5, 3)
a
data.frame(t = c(1,2,3,4,5),p=a)
data.frame(t = c(1,2,3,4,5),c("a","b","c")=a)
data.frame(t = c(1,2,3,4,5),a)
a = data.frame(t = c(1,2,3,4,5),a)
colnames(a)
colnames(a) = c("t", paste("group", 1:3, sep=""))
a
a
a
a[1]
data.frame(a[1], stack(a[2:4]))
rm(list=ls())
library(devtools)
devtools::load_all("/Users/ruilinli/coxtv")
library(survival)
library(dplyr)
N = nrow(jasa)
jasa$ID = 1:N
jasa$y = pmax(0.5, as.numeric(jasa$fu.date - jasa$accept.dt))
jasa$age = jasa$age - 48
jasa$year = as.numeric(jasa$accept.dt - as.Date("1967-10-01"))/365.25
jasa$txtime= with(jasa, ifelse(tx.date== fu.date,
(tx.date -accept.dt) -.5,
(tx.date - accept.dt)))
jasa$status = jasa$fustat
tv_df = data.frame(ID=1:N, time=0, value = 0)
tmp = jasa %>% select(c(ID, txtime)) %>% filter(!is.na(txtime))
tmp$time = tmp$txtime
tmp$value = 1
tmp = select(tmp, c(ID, time, value))
tv_df = rbind(tv_df, tmp)
tv2 = tv_df
tv2$value = tv2$value * jasa$age[match(tv2$ID, jasa$ID)]
tv_list = list(tv1=tv_df, tv2=tv2)
r1 = coxtv(jasa, tv_list,c('surgery', 'year', 'age'),c(0.01, 0.0))
cindex_tv(jasa, tv_list,c('surgery', 'year', 'age'), r1[[2]])
rm(list=ls())
library(devtools)
devtools::load_all("/Users/ruilinli/coxtv")
library(survival)
library(dplyr)
N = nrow(jasa)
jasa$ID = 1:N
jasa$y = pmax(0.5, as.numeric(jasa$fu.date - jasa$accept.dt))
jasa$age = jasa$age - 48
jasa$year = as.numeric(jasa$accept.dt - as.Date("1967-10-01"))/365.25
jasa$txtime= with(jasa, ifelse(tx.date== fu.date,
(tx.date -accept.dt) -.5,
(tx.date - accept.dt)))
jasa$status = jasa$fustat
tv_df = data.frame(ID=1:N, time=0, value = 0)
tmp = jasa %>% select(c(ID, txtime)) %>% filter(!is.na(txtime))
tmp$time = tmp$txtime
tmp$value = 1
tmp = select(tmp, c(ID, time, value))
tv_df = rbind(tv_df, tmp)
tv2 = tv_df
tv2$value = tv2$value * jasa$age[match(tv2$ID, jasa$ID)]
tv_list = list(tv1=tv_df, tv2=tv2)
r1 = coxtv(jasa, tv_list,c('surgery', 'year', 'age'),c(0.01, 0.0))
cindex_tv(jasa, tv_list,c('surgery', 'year', 'age'), r1[[2]])
KM_curve_tv(jasa, tv[[1]], ngroup=2)
KM_curve_tv(jasa, tv_list[[1]], ngroup=2)
KM_curve_tv(jasa, tv_list[[1]], ngroup=2)
rm(list=ls())
library(devtools)
devtools::load_all("/Users/ruilinli/coxtv")
library(survival)
library(dplyr)
N = nrow(jasa)
jasa$ID = 1:N
jasa$y = pmax(0.5, as.numeric(jasa$fu.date - jasa$accept.dt))
jasa$age = jasa$age - 48
jasa$year = as.numeric(jasa$accept.dt - as.Date("1967-10-01"))/365.25
jasa$txtime= with(jasa, ifelse(tx.date== fu.date,
(tx.date -accept.dt) -.5,
(tx.date - accept.dt)))
jasa$status = jasa$fustat
tv_df = data.frame(ID=1:N, time=0, value = 0)
tmp = jasa %>% select(c(ID, txtime)) %>% filter(!is.na(txtime))
tmp$time = tmp$txtime
tmp$value = 1
tmp = select(tmp, c(ID, time, value))
tv_df = rbind(tv_df, tmp)
tv2 = tv_df
tv2$value = tv2$value * jasa$age[match(tv2$ID, jasa$ID)]
tv_list = list(tv1=tv_df, tv2=tv2)
r1 = coxtv(jasa, tv_list,c('surgery', 'year', 'age'),c(0.01, 0.0))
cindex_tv(jasa, tv_list,c('surgery', 'year', 'age'), r1[[2]])
KM_curve_tv(jasa, tv_list[[1]], ngroup=2)
rm(list=ls())
library(devtools)
devtools::load_all("/Users/ruilinli/coxtv")
library(survival)
library(dplyr)
N = nrow(jasa)
jasa$ID = 1:N
jasa$y = pmax(0.5, as.numeric(jasa$fu.date - jasa$accept.dt))
jasa$age = jasa$age - 48
jasa$year = as.numeric(jasa$accept.dt - as.Date("1967-10-01"))/365.25
jasa$txtime= with(jasa, ifelse(tx.date== fu.date,
(tx.date -accept.dt) -.5,
(tx.date - accept.dt)))
jasa$status = jasa$fustat
tv_df = data.frame(ID=1:N, time=0, value = 0)
tmp = jasa %>% select(c(ID, txtime)) %>% filter(!is.na(txtime))
tmp$time = tmp$txtime
tmp$value = 1
tmp = select(tmp, c(ID, time, value))
tv_df = rbind(tv_df, tmp)
tv2 = tv_df
tv2$value = tv2$value * jasa$age[match(tv2$ID, jasa$ID)]
tv_list = list(tv1=tv_df, tv2=tv2)
r1 = coxtv(jasa, tv_list,c('surgery', 'year', 'age'),c(0.01, 0.0))
cindex_tv(jasa, tv_list,c('surgery', 'year', 'age'), r1[[2]])
KM_curve_tv(jasa, tv_list[[1]], ngroup=2)
rm(list=ls())
library(devtools)
devtools::load_all("/Users/ruilinli/coxtv")
library(survival)
library(dplyr)
N = nrow(jasa)
jasa$ID = 1:N
jasa$y = pmax(0.5, as.numeric(jasa$fu.date - jasa$accept.dt))
jasa$age = jasa$age - 48
jasa$year = as.numeric(jasa$accept.dt - as.Date("1967-10-01"))/365.25
jasa$txtime= with(jasa, ifelse(tx.date== fu.date,
(tx.date -accept.dt) -.5,
(tx.date - accept.dt)))
jasa$status = jasa$fustat
tv_df = data.frame(ID=1:N, time=0, value = 0)
tmp = jasa %>% select(c(ID, txtime)) %>% filter(!is.na(txtime))
tmp$time = tmp$txtime
tmp$value = 1
tmp = select(tmp, c(ID, time, value))
tv_df = rbind(tv_df, tmp)
tv2 = tv_df
tv2$value = tv2$value * jasa$age[match(tv2$ID, jasa$ID)]
tv_list = list(tv1=tv_df, tv2=tv2)
r1 = coxtv(jasa, tv_list,c('surgery', 'year', 'age'),c(0.01, 0.0))
cindex_tv(jasa, tv_list,c('surgery', 'year', 'age'), r1[[2]])
KM_curve_tv(jasa, tv_list[[1]], ngroup=2)
rm(list=ls())
library(devtools)
devtools::load_all("/Users/ruilinli/coxtv")
library(survival)
library(dplyr)
N = nrow(jasa)
jasa$ID = 1:N
jasa$y = pmax(0.5, as.numeric(jasa$fu.date - jasa$accept.dt))
jasa$age = jasa$age - 48
jasa$year = as.numeric(jasa$accept.dt - as.Date("1967-10-01"))/365.25
jasa$txtime= with(jasa, ifelse(tx.date== fu.date,
(tx.date -accept.dt) -.5,
(tx.date - accept.dt)))
jasa$status = jasa$fustat
tv_df = data.frame(ID=1:N, time=0, value = 0)
tmp = jasa %>% select(c(ID, txtime)) %>% filter(!is.na(txtime))
tmp$time = tmp$txtime
tmp$value = 1
tmp = select(tmp, c(ID, time, value))
tv_df = rbind(tv_df, tmp)
tv2 = tv_df
tv2$value = tv2$value * jasa$age[match(tv2$ID, jasa$ID)]
tv_list = list(tv1=tv_df, tv2=tv2)
r1 = coxtv(jasa, tv_list,c('surgery', 'year', 'age'),c(0.01, 0.0))
cindex_tv(jasa, tv_list,c('surgery', 'year', 'age'), r1[[2]])
KM_curve_tv(jasa, tv_list[[1]], ngroup=2)
rm(list=ls())
library(devtools)
devtools::load_all("/Users/ruilinli/coxtv")
library(survival)
library(dplyr)
N = nrow(jasa)
jasa$ID = 1:N
jasa$y = pmax(0.5, as.numeric(jasa$fu.date - jasa$accept.dt))
jasa$age = jasa$age - 48
jasa$year = as.numeric(jasa$accept.dt - as.Date("1967-10-01"))/365.25
jasa$txtime= with(jasa, ifelse(tx.date== fu.date,
(tx.date -accept.dt) -.5,
(tx.date - accept.dt)))
jasa$status = jasa$fustat
tv_df = data.frame(ID=1:N, time=0, value = 0)
tmp = jasa %>% select(c(ID, txtime)) %>% filter(!is.na(txtime))
tmp$time = tmp$txtime
tmp$value = 1
tmp = select(tmp, c(ID, time, value))
tv_df = rbind(tv_df, tmp)
tv2 = tv_df
tv2$value = tv2$value * jasa$age[match(tv2$ID, jasa$ID)]
tv_list = list(tv1=tv_df, tv2=tv2)
r1 = coxtv(jasa, tv_list,c('surgery', 'year', 'age'),c(0.01, 0.0))
cindex_tv(jasa, tv_list,c('surgery', 'year', 'age'), r1[[2]])
KM_curve_tv(jasa, tv_list[[1]], ngroup=2)
rm(list=ls())
library(devtools)
devtools::load_all("/Users/ruilinli/coxtv")
library(survival)
library(dplyr)
N = nrow(jasa)
jasa$ID = 1:N
jasa$y = pmax(0.5, as.numeric(jasa$fu.date - jasa$accept.dt))
jasa$age = jasa$age - 48
jasa$year = as.numeric(jasa$accept.dt - as.Date("1967-10-01"))/365.25
jasa$txtime= with(jasa, ifelse(tx.date== fu.date,
(tx.date -accept.dt) -.5,
(tx.date - accept.dt)))
jasa$status = jasa$fustat
tv_df = data.frame(ID=1:N, time=0, value = 0)
tmp = jasa %>% select(c(ID, txtime)) %>% filter(!is.na(txtime))
tmp$time = tmp$txtime
tmp$value = 1
tmp = select(tmp, c(ID, time, value))
tv_df = rbind(tv_df, tmp)
tv2 = tv_df
tv2$value = tv2$value * jasa$age[match(tv2$ID, jasa$ID)]
tv_list = list(tv1=tv_df, tv2=tv2)
r1 = coxtv(jasa, tv_list,c('surgery', 'year', 'age'),c(0.01, 0.0))
cindex_tv(jasa, tv_list,c('surgery', 'year', 'age'), r1[[2]])
KM_curve_tv(jasa, tv_list[[1]], ngroup=2)
rm(list=ls())
library(devtools)
devtools::load_all("/Users/ruilinli/coxtv")
library(survival)
library(dplyr)
N = nrow(jasa)
jasa$ID = 1:N
jasa$y = pmax(0.5, as.numeric(jasa$fu.date - jasa$accept.dt))
jasa$age = jasa$age - 48
jasa$year = as.numeric(jasa$accept.dt - as.Date("1967-10-01"))/365.25
jasa$txtime= with(jasa, ifelse(tx.date== fu.date,
(tx.date -accept.dt) -.5,
(tx.date - accept.dt)))
jasa$status = jasa$fustat
tv_df = data.frame(ID=1:N, time=0, value = 0)
tmp = jasa %>% select(c(ID, txtime)) %>% filter(!is.na(txtime))
tmp$time = tmp$txtime
tmp$value = 1
tmp = select(tmp, c(ID, time, value))
tv_df = rbind(tv_df, tmp)
tv2 = tv_df
tv2$value = tv2$value * jasa$age[match(tv2$ID, jasa$ID)]
tv_list = list(tv1=tv_df, tv2=tv2)
r1 = coxtv(jasa, tv_list,c('surgery', 'year', 'age'),c(0.01, 0.0))
cindex_tv(jasa, tv_list,c('surgery', 'year', 'age'), r1[[2]])
KM_curve_tv(jasa, tv_list[[1]], ngroup=2)
rm(list=ls())
library(devtools)
devtools::load_all("/Users/ruilinli/coxtv")
library(survival)
library(dplyr)
N = nrow(jasa)
jasa$ID = 1:N
jasa$y = pmax(0.5, as.numeric(jasa$fu.date - jasa$accept.dt))
jasa$age = jasa$age - 48
jasa$year = as.numeric(jasa$accept.dt - as.Date("1967-10-01"))/365.25
jasa$txtime= with(jasa, ifelse(tx.date== fu.date,
(tx.date -accept.dt) -.5,
(tx.date - accept.dt)))
jasa$status = jasa$fustat
tv_df = data.frame(ID=1:N, time=0, value = 0)
tmp = jasa %>% select(c(ID, txtime)) %>% filter(!is.na(txtime))
tmp$time = tmp$txtime
tmp$value = 1
tmp = select(tmp, c(ID, time, value))
tv_df = rbind(tv_df, tmp)
tv2 = tv_df
tv2$value = tv2$value * jasa$age[match(tv2$ID, jasa$ID)]
tv_list = list(tv1=tv_df, tv2=tv2)
r1 = coxtv(jasa, tv_list,c('surgery', 'year', 'age'),c(0.01, 0.0))
cindex_tv(jasa, tv_list,c('surgery', 'year', 'age'), r1[[2]])
KM_curve_tv(jasa, tv_list[[1]], ngroup=2)
jasa$y
min(jasa$y)
rm(list=ls())
library(devtools)
devtools::load_all("/Users/ruilinli/coxtv")
library(survival)
library(dplyr)
N = nrow(jasa)
jasa$ID = 1:N
jasa$y = pmax(0.5, as.numeric(jasa$fu.date - jasa$accept.dt))
jasa$age = jasa$age - 48
jasa$year = as.numeric(jasa$accept.dt - as.Date("1967-10-01"))/365.25
jasa$txtime= with(jasa, ifelse(tx.date== fu.date,
(tx.date -accept.dt) -.5,
(tx.date - accept.dt)))
jasa$status = jasa$fustat
tv_df = data.frame(ID=1:N, time=0, value = 0)
tmp = jasa %>% select(c(ID, txtime)) %>% filter(!is.na(txtime))
tmp$time = tmp$txtime
tmp$value = 1
tmp = select(tmp, c(ID, time, value))
tv_df = rbind(tv_df, tmp)
tv2 = tv_df
tv2$value = tv2$value * jasa$age[match(tv2$ID, jasa$ID)]
tv_list = list(tv1=tv_df, tv2=tv2)
r1 = coxtv(jasa, tv_list,c('surgery', 'year', 'age'),c(0.01, 0.0))
cindex_tv(jasa, tv_list,c('surgery', 'year', 'age'), r1[[2]])
KM_curve_tv(jasa, tv_list[[1]], ngroup=2)
rm(list=ls())
library(devtools)
devtools::load_all("/Users/ruilinli/coxtv")
library(survival)
library(dplyr)
N = nrow(jasa)
jasa$ID = 1:N
jasa$y = pmax(0.5, as.numeric(jasa$fu.date - jasa$accept.dt))
jasa$age = jasa$age - 48
jasa$year = as.numeric(jasa$accept.dt - as.Date("1967-10-01"))/365.25
jasa$txtime= with(jasa, ifelse(tx.date== fu.date,
(tx.date -accept.dt) -.5,
(tx.date - accept.dt)))
jasa$status = jasa$fustat
tv_df = data.frame(ID=1:N, time=0, value = 0)
tmp = jasa %>% select(c(ID, txtime)) %>% filter(!is.na(txtime))
tmp$time = tmp$txtime
tmp$value = 1
tmp = select(tmp, c(ID, time, value))
tv_df = rbind(tv_df, tmp)
tv2 = tv_df
tv2$value = tv2$value * jasa$age[match(tv2$ID, jasa$ID)]
tv_list = list(tv1=tv_df, tv2=tv2)
r1 = coxtv(jasa, tv_list,c('surgery', 'year', 'age'),c(0.01, 0.0))
cindex_tv(jasa, tv_list,c('surgery', 'year', 'age'), r1[[2]])
KM_curve_tv(jasa, tv_list[[1]], ngroup=2)
KM_curve_tv(jasa, tv_list[[2]], ngroup=2)
KM_curve_tv(jasa, tv_list[[2]], ngroup=3)
rm(list=ls())
library(devtools)
devtools::load_all("/Users/ruilinli/coxtv")
library(survival)
library(dplyr)
N = nrow(jasa)
jasa$ID = 1:N
jasa$y = pmax(0.5, as.numeric(jasa$fu.date - jasa$accept.dt))
jasa$age = jasa$age - 48
jasa$year = as.numeric(jasa$accept.dt - as.Date("1967-10-01"))/365.25
jasa$txtime= with(jasa, ifelse(tx.date== fu.date,
(tx.date -accept.dt) -.5,
(tx.date - accept.dt)))
jasa$status = jasa$fustat
tv_df = data.frame(ID=1:N, time=0, value = 0)
tmp = jasa %>% select(c(ID, txtime)) %>% filter(!is.na(txtime))
tmp$time = tmp$txtime
tmp$value = 1
tmp = select(tmp, c(ID, time, value))
tv_df = rbind(tv_df, tmp)
tv2 = tv_df
tv2$value = tv2$value * jasa$age[match(tv2$ID, jasa$ID)]
tv_list = list(tv1=tv_df, tv2=tv2)
r1 = coxtv(jasa, tv_list,c('surgery', 'year', 'age'),c(0.01, 0.0))
cindex_tv(jasa, tv_list,c('surgery', 'year', 'age'), r1[[2]])
KM_curve_tv(jasa, tv_list[[2]], ngroup=3)
tv_list[[2]]
quantile(tv_list[[2]]$value, c(0, 0.33, 0.66))
rm(list=ls())
library(devtools)
devtools::load_all("/Users/ruilinli/coxtv")
library(survival)
library(dplyr)
N = nrow(jasa)
jasa$ID = 1:N
jasa$y = pmax(0.5, as.numeric(jasa$fu.date - jasa$accept.dt))
jasa$age = jasa$age - 48
jasa$year = as.numeric(jasa$accept.dt - as.Date("1967-10-01"))/365.25
jasa$txtime= with(jasa, ifelse(tx.date== fu.date,
(tx.date -accept.dt) -.5,
(tx.date - accept.dt)))
jasa$status = jasa$fustat
tv_df = data.frame(ID=1:N, time=0, value = 0)
tmp = jasa %>% select(c(ID, txtime)) %>% filter(!is.na(txtime))
tmp$time = tmp$txtime
tmp$value = 1
tmp = select(tmp, c(ID, time, value))
tv_df = rbind(tv_df, tmp)
tv2 = tv_df
tv2$value = tv2$value * jasa$age[match(tv2$ID, jasa$ID)]
tv_list = list(tv1=tv_df, tv2=tv2)
r1 = coxtv(jasa, tv_list,c('surgery', 'year', 'age'),c(0.01, 0.0))
cindex_tv(jasa, tv_list,c('surgery', 'year', 'age'), r1[[2]])
KM_curve_tv(jasa, tv_list[[1]], ngroup=3)
devtools::document()
devtools::build_vignettes()
